<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The cartopy geometry pipeline &mdash; Topology transforms 1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Topology transforms 1 documentation" href="index.html" />
    <link rel="prev" title="Topology transformations for R3=&gt;R2 projections" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index.html" title="Topology transformations for R3=&gt;R2 projections"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Topology transforms 1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-cartopy-geometry-pipeline">
<h1>The cartopy geometry pipeline<a class="headerlink" href="#the-cartopy-geometry-pipeline" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Taking a spherical geometry representation from one projected coordinate system into another for all but the simplest cases inevitably involves a topological transformation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A topolological transform - cut and glue a geometry into the desired form. Stretching is not a topological transform.</p>
</div>
<p>For instance, imagine transforming the outline of Africa onto a projection with the dateline (which is also the antimeridian of the PlateCarree projection) in the middle.
Essentially, we must cut the geometry into two parts at the new antimeridian (now 0 degrees longitude):</p>
<p>(<a class="reference external" href="./code/africa_to_pc180.py">Source code</a>, <a class="reference external" href="./code/africa_to_pc180.png">png</a>, <a class="reference external" href="./code/africa_to_pc180.hires.png">hires.png</a>, <a class="reference external" href="./code/africa_to_pc180.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/africa_to_pc180.png" src="_images/africa_to_pc180.png" />
</div>
<p>Transforming from one cylindrical projection to another is a relatively straightforward concept, at least, until we start to involve geometries covering the poles.</p>
<p>Irrespective of the coordinate system of the vertices, it is very unusual to have geometries in a non-projected (i.e. spherical) topology.
To help understand this, in your minds eye, imagine the outline of Antarctica.</p>
<p>(<a class="reference external" href="./code/antarctica.py">Source code</a>, <a class="reference external" href="./code/antarctica.png">png</a>, <a class="reference external" href="./code/antarctica.hires.png">hires.png</a>, <a class="reference external" href="./code/antarctica.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/antarctica.png" src="_images/antarctica.png" />
</div>
<p>Tracing the coordinates of the Antarctica polygon on the left hand plot in a clockwise direction starting from north-most point, after following the coastline of Antarctica, we eventually come to a straight line which follows the dateline down to the bottom of our plot, then goes back across to the left hand side and then up to the coastal coordinate and along.
When we look at the map on the right hand side, we see that there is no such line in real life - in actual fact, the straight lines on the left-hand map are just how we must represent a polygon which crosses the dateline of the map.</p>
<p>The polygon therefore has a topology suitable for this map, but does not have a spherical topology.</p>
<p>The right hand map however, does link the two points which cross the dateline together, therefore its topology is close to being spherical.</p>
<p>Why close? Because in 2D space, a sequence of coordinates which start and end at the same place are sufficient to represent a filled area un-ambiguously - on the sphere however we cannot determine which side of the line should be filled, and therefore impose an extra constraint - namely that the order of the coordinate sequence determines the side on which to fill (e.g. always fill on the right hand side of the line). <strong>Action</strong>: Ask Jason how complex spherical geometries are handled - or just try it.</p>
<p>It is not possible to have a projected topology in which all polygons have a spherical topology - going from a sphere to a projected map <strong>always</strong> involves a topological transformation of some kind.</p>
</div>
<div class="section" id="the-three-phases-of-geometry-transformation-in-cartopy">
<h2>The three phases of geometry transformation in Cartopy<a class="headerlink" href="#the-three-phases-of-geometry-transformation-in-cartopy" title="Permalink to this headline">¶</a></h2>
<p>Cartopy separates the process of transforming a projected geometry to another projected geometry into 3 distinct phases:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Transform the geometry from the topology of the source projection to spherical topology.</li>
<li>Transform the geometry from spherical topology to the topology of the target projection.</li>
<li>Interpolate the geometry to a suitable precision in the target projection&#8217;s coordinate system.</li>
</ol>
</div></blockquote>
<div class="section" id="phase-one-source-topolgy-to-spherical-topology">
<h3>Phase one: Source topolgy to spherical topology<a class="headerlink" href="#phase-one-source-topolgy-to-spherical-topology" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>The first phase in the process involves knowledge of the topology of the incoming geometry.</dt>
<dd><ul class="first last simple">
<li>For cylindrical projections, the topology is a single antimeridian line and singularities at both poles.</li>
<li>For stereographic projections, the topology is a ring at the anti-podal point (e.g. the south pole for north polar stereographic).</li>
</ul>
</dd>
</dl>
<p>With this knowledge, we inspect each geometry and identify and remove any topological features that have been applied to the given geometry.
For example, in Plate Carree we remove the lines, at, to and from the south pole from the outline of Antarctica.
Any points which link up to another spherically (aka a line which crosses a discontinuity) are joined back together and a note that the join has taken place is recorded.
This is the inverse operation to phase 2, so see there for more clarity on what needs to be undone.</p>
<p>(<a class="reference external" href="./code/pc_to_spherical_antarctica.py">Source code</a>, <a class="reference external" href="./code/pc_to_spherical_antarctica.png">png</a>, <a class="reference external" href="./code/pc_to_spherical_antarctica.hires.png">hires.png</a>, <a class="reference external" href="./code/pc_to_spherical_antarctica.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/pc_to_spherical_antarctica.png" src="_images/pc_to_spherical_antarctica.png" />
</div>
<p>All geometries are now correctly oriented (fill on right hand side of vertex, aka clockwise).</p>
<p>The coordinate <strong>values</strong> of the original geometry are preserved (the topology is spherical, but the coordinates themselves are not).</p>
</div>
<div class="section" id="phase-two-spherical-toplogy-to-target-topology">
<h3>Phase Two: Spherical toplogy to target topology<a class="headerlink" href="#phase-two-spherical-toplogy-to-target-topology" title="Permalink to this headline">¶</a></h3>
<p>Again, we must know the topology of the target projection, with this knowledge we apply this topology to the spherical geometry.</p>
<p>For example, supposing we have the ring which represents the outline of Antarctica (in a spherical topology, remember) and wanted to project the geometry to a Cylindirical topology.
We traverse the coordinates and cut those segments which cross the antimeridian. Any cut points are then joined together by great circles, taking care to apply the appropriate fill direction based on the order of the incoming geometry.</p>
<p>The coordinate <strong>values</strong> of the original geometry are still preserved, except for the inserted great circles, but the topology is now that of the target projection.</p>
<p>(<a class="reference external" href="./code/spherical_antarctica_to_pc180.py">Source code</a>, <a class="reference external" href="./code/spherical_antarctica_to_pc180.png">png</a>, <a class="reference external" href="./code/spherical_antarctica_to_pc180.hires.png">hires.png</a>, <a class="reference external" href="./code/spherical_antarctica_to_pc180.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/spherical_antarctica_to_pc180.png" src="_images/spherical_antarctica_to_pc180.png" />
</div>
</div>
<div class="section" id="phase-three-interpolate-to-arbitrary-precision">
<h3>Phase Three: Interpolate to arbitrary precision<a class="headerlink" href="#phase-three-interpolate-to-arbitrary-precision" title="Permalink to this headline">¶</a></h3>
<p>Now that we have done all of the hard work of ensuring that the geomerty is in the topology of the target coordinate system we can guarantee that no matter
what precision we wish to draw the geometry, it will not need to be cut or glued together.</p>
<p>We now need to be provided a function which, given two vertices in the source coordinate system, can interpolate smaller vertices which we can insert into the projected geometry.
The interpolation doesn&#8217;t need to worry about whether a segment crosses the dateline (or any other topological effect) as we have already determined that no such segment exists in the transformed geometry. We also need a function which can interpolate our great circles in the same regard.</p>
<p>Armed with these two functions, we traverse the geometry, interpolating each segment until it reaches a threshold of &#8220;acceptablity&#8221;, and eventually end up with a geometry which can be used for various purposes, including drawing on a map.</p>
<p>(<a class="reference external" href="./code/interpolate.py">Source code</a>, <a class="reference external" href="./code/interpolate.png">png</a>, <a class="reference external" href="./code/interpolate.hires.png">hires.png</a>, <a class="reference external" href="./code/interpolate.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/interpolate.png" src="_images/interpolate.png" />
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The cartopy geometry pipeline</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#the-three-phases-of-geometry-transformation-in-cartopy">The three phases of geometry transformation in Cartopy</a><ul>
<li><a class="reference internal" href="#phase-one-source-topolgy-to-spherical-topology">Phase one: Source topolgy to spherical topology</a></li>
<li><a class="reference internal" href="#phase-two-spherical-toplogy-to-target-topology">Phase Two: Spherical toplogy to target topology</a></li>
<li><a class="reference internal" href="#phase-three-interpolate-to-arbitrary-precision">Phase Three: Interpolate to arbitrary precision</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Topology transformations for R3=&gt;R2 projections</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/cartopy_geometry_pipeline.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index.html" title="Topology transformations for R3=&gt;R2 projections"
             >previous</a> |</li>
        <li><a href="index.html">Topology transforms 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Phil Elson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>